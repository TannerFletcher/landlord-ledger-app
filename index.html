<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property Walkthrough Ledger</title>
    <!-- Load Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load React, ReactDOM, and Babel for the application logic -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .scroll-area { max-height: 20rem; overflow-y: auto; }
        
        /* Visually hide file input but ensure the button is clickable */
        .file-input-wrapper { 
            position: relative; 
            overflow: hidden; 
            display: block;
            cursor: pointer;
        }
        .file-input-wrapper input[type=file] {
            font-size: 100px;
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
        }

        /* --- PDF PRINT STYLES (Crucial for Print Export) --- */
        @media print {
            /* Hide non-essential UI elements for a clean PDF */
            .no-print, header button, .room-card button, .input-group, .add-room-btn { display: none !important; }
            body { 
                background-color: white !important; 
                color: black !important;
                margin: 0;
                padding: 0;
            }
            #root { 
                padding: 1cm; 
                width: 100%;
                max-width: none !important;
            }
            /* Ensures each property report starts on a fresh page */
            .property-summary {
                page-break-after: always; 
            }
            .room-card {
                border: 1px solid #ccc;
                margin-bottom: 1rem;
                padding: 1rem;
                box-shadow: none;
            }
            .photo-grid {
                /* Adjust photo layout for print mode */
                grid-template-columns: repeat(3, 1fr) !important; 
            }
            .photo-meta {
                /* Print Meta Styling */
                font-size: 10px;
                color: #555;
                padding: 4px 0;
                display: block !important;
                white-space: normal !important;
                overflow: visible !important;
                max-height: none !important;
                text-align: left;
            }
        }
    </style>
</head>
<body>

    <div id="root" class="min-h-screen flex flex-col items-center p-4 sm:p-8"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;

        // --- Local Storage Key ---
        const STORAGE_KEY = 'LandlordLedgerData';
        
        // --- Utility Functions ---
        
        const loadData = () => {
            try {
                const storedData = localStorage.getItem(STORAGE_KEY);
                return storedData ? JSON.parse(storedData) : { properties: [] };
            } catch (error) {
                console.error("Error loading state from localStorage:", error);
                return { properties: [] };
            }
        };

        const saveData = (data) => {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            } catch (error) {
                console.error("Error saving state from localStorage:", error);
                window.alert("Storage Limit Reached! Cannot save more data. Please delete old properties or photos.");
            }
        };

        // --- Main-Thread Logic for Image Compression with Timeout ---
        const compressImageMainThread = (file, timeoutMs = 10000) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                let img = null;
                
                // --- Safety Timeout ---
                const timeout = setTimeout(() => {
                    reject(new Error("Image processing timed out (Exceeded 10 seconds). The file is too large for fast in-browser processing."));
                }, timeoutMs);

                reader.onload = (readerEvent) => {
                    img = new Image();
                    
                    img.onload = () => {
                        clearTimeout(timeout); // SUCCESS: Clear timeout
                        try {
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            
                            if (!ctx) {
                                return reject(new Error('Could not get canvas context for drawing.'));
                            }

                            // --- AGGRESSIVE COMPRESSION SETTINGS ---
                            const MAX_SIZE = 500; // Max width or height in pixels (Further reduced for maximum speed)
                            const JPEG_QUALITY = 0.5; // JPEG compression quality (Drastically reduced for maximum speed and size reduction)
                            // --- END AGGRESSIVE COMPRESSION SETTINGS ---
                            
                            let width = img.width;
                            let height = img.height;

                            // Resizing logic (Scale down to fit MAX_SIZE)
                            if (width > height) {
                                if (width > MAX_SIZE) {
                                    height *= MAX_SIZE / width;
                                    width = MAX_SIZE;
                                }
                            } else {
                                if (height > MAX_SIZE) {
                                    width *= MAX_SIZE / height;
                                    height = MAX_SIZE;
                                }
                            }

                            canvas.width = width;
                            canvas.height = height;
                            
                            // Draw image to canvas and compress
                            ctx.drawImage(img, 0, 0, width, height);
                            const compressedDataUrl = canvas.toDataURL('image/jpeg', JPEG_QUALITY);
                            
                            resolve(compressedDataUrl);

                        } catch (e) {
                            reject(new Error('Image processing failed during drawing/compression: ' + e.message));
                        }
                    };
                    
                    img.onerror = () => {
                         clearTimeout(timeout); // ERROR: Clear timeout
                         reject(new Error('Image failed to load from FileReader result (possibly corrupted).'));
                    };
                    
                    // Start loading the image data (this is the potentially slow step)
                    img.src = readerEvent.target.result;
                };

                reader.onerror = (error) => {
                    clearTimeout(timeout); // ERROR: Clear timeout
                    reject(new Error('FileReader failed to read file.'));
                };
                
                // Read the file into memory as a Data URL
                reader.readAsDataURL(file);
            });
        };


        // --- Icon Components ---
        const Plus = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;
        const Trash2 = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path><path d="M10 11v6"></path><path d="M14 11v6"></path><path d="M17 6V4a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2v2"></path></svg>;
        const Printer = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8" /></svg>;
        const Image = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>;
        const Notebook = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 13.5V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 0 2 2h-2c-.75 0-1.4-.35-1.8-.9L2 13.5"></path><path d="M7 12h8"></path><path d="M7 16h8"></path></svg>;


        // --- Custom Confirmation Modal ---

        const CustomConfirm = ({ message, onConfirm, onCancel }) => (
            <div className="fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center p-4 no-print">
                <div className="bg-white rounded-xl p-6 w-full max-w-xs shadow-2xl">
                    <p className="text-lg font-medium text-gray-800 mb-6">{message}</p>
                    <div className="flex justify-end space-x-3">
                        <button onClick={onCancel} className="px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-100 transition">Cancel</button>
                        <button onClick={onConfirm} className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">Delete</button>
                    </div>
                </div>
            </div>
        );

        // --- Room Card/Editor Component ---

        const RoomCard = ({ room, updateRoom, deleteRoom, propertyId, confirm }) => {
            const [newNote, setNewNote] = useState('');
            const [isExpanded, setIsExpanded] = useState(false);
            const [isCapturing, setIsCapturing] = useState(false);
            
            const handleUpdate = (field, value) => {
                updateRoom(propertyId, room.id, { [field]: value });
            };

            const handleNoteAdd = () => {
                if (newNote.trim()) {
                    const timestamp = new Date().toLocaleDateString('en-US', { 
                        year: 'numeric', month: '2-digit', day: '2-digit', 
                        hour: '2-digit', minute: '2-digit' 
                    });
                    const formattedNote = `[${timestamp}] ${newNote.trim()}`;
                    handleUpdate('notes', [...room.notes, formattedNote]);
                    setNewNote('');
                }
            };
            
            const handleNoteDelete = (indexToDelete) => {
                const updatedNotes = room.notes.filter((_, index) => index !== indexToDelete);
                handleUpdate('notes', updatedNotes);
            };

            const handlePhotoChange = async (event) => {
                const file = event.target.files[0];
                if (!file) return;

                setIsCapturing(true);
                
                // --- HEIC/HEIF Check (Prevents native browser decoding failure) ---
                if (file.type.toLowerCase().includes('heic') || file.type.toLowerCase().includes('heif')) {
                    window.alert(
                        "Image format error: This app cannot natively process HEIC/HEIF files. \n\n" +
                        "**Quick Fix on iPhone:** Go to Settings -> Camera -> Formats, and select 'Most Compatible' (JPEG). \n\n" +
                        "Then try capturing the photo again."
                    );
                    // CRITICAL: Ensure the loading spinner stops and input is cleared
                    setIsCapturing(false);
                    event.target.value = null; 
                    return;
                }
                
                // Max size check for the raw file before processing (4MB safety limit)
                const MAX_SIZE_BYTES_RAW = 4 * 1024 * 1024; 
                if (file.size > MAX_SIZE_BYTES_RAW) {
                    window.alert("Initial photo file too large (over 4MB). Please use a lower resolution photo.");
                    // CRITICAL: Ensure the loading spinner stops and input is cleared
                    setIsCapturing(false);
                    event.target.value = null; 
                    return;
                }
                
                try {
                    const timestamp = new Date().toLocaleString();
                    
                    // Call the main-thread processing function with the safety timeout
                    const dataUrl = await compressImageMainThread(file); 

                    const newPhoto = {
                        dataUrl,
                        timestamp,
                    };

                    handleUpdate('photos', [...room.photos, newPhoto]);
                } catch (error) {
                    console.error("Critical Image Processing Error:", error);
                    window.alert(`Could not process image. Error: ${error.message}. The image might still be too large or the processing timed out.`);
                } finally {
                    // CRITICAL: Ensure the loading spinner stops
                    setIsCapturing(false);
                    event.target.value = null; // Clear input
                }
            };

            const handleDeleteRoom = async (e) => {
                e.stopPropagation();
                const confirmed = await confirm("Are you sure you want to delete this room? All notes and photos will be lost.");
                if (confirmed) {
                    deleteRoom(propertyId, room.id);
                }
            };

            const handlePhotoDelete = (indexToDelete) => {
                const updatedPhotos = room.photos.filter((_, index) => index !== indexToDelete);
                handleUpdate('photos', updatedPhotos);
            };

            const totalNotes = room.notes.length;
            const totalPhotos = room.photos.length;

            return (
                <div className="room-card bg-white p-4 rounded-xl shadow-lg border border-gray-100 transition duration-300">
                    {/* Header: Name and Summary */}
                    <div className="flex justify-between items-center cursor-pointer" onClick={() => setIsExpanded(!isExpanded)}>
                        <h3 className="text-xl font-bold text-gray-800 flex items-center">
                            {room.name || "Untitled Room"}
                            <span className="ml-3 text-sm font-normal text-gray-500 hidden sm:inline">
                                ({totalPhotos} Photos, {totalNotes} Notes)
                            </span>
                        </h3>
                        <div className="flex items-center space-x-2 no-print">
                            <button className="text-gray-400 hover:text-gray-600 transition" aria-label={isExpanded ? "Collapse" : "Expand"}>
                                <svg className={`w-6 h-6 transform transition-transform ${isExpanded ? 'rotate-180' : 'rotate-0'}`} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2">
                                    <path strokeLinecap="round" strokeLinejoin="round" d="M19 9l-7 7-7-7" />
                                </svg>
                            </button>
                            <button 
                                onClick={handleDeleteRoom}
                                className="text-red-400 hover:text-red-600 p-1 rounded-full transition"
                                title="Delete Room"
                            >
                                <Trash2 className="w-5 h-5" />
                            </button>
                        </div>
                    </div>

                    {/* Editor / Details Section */}
                    {isExpanded && (
                        <div className="mt-4 pt-4 border-t border-gray-100 space-y-6">
                            
                            {/* Room Name Input */}
                            <div className="input-group no-print">
                                <label className="block text-sm font-medium text-gray-700 mb-1">Room Name</label>
                                <input
                                    type="text"
                                    value={room.name}
                                    onChange={(e) => handleUpdate('name', e.target.value)}
                                    placeholder="e.g., Master Bathroom, Kitchen"
                                    className="w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                />
                            </div>

                            {/* Notes Section */}
                            <div>
                                <h4 className="flex items-center text-lg font-semibold text-teal-600 mb-2">
                                    <Notebook className="w-5 h-5 mr-2"/> Notes
                                </h4>
                                <div className="space-y-2 mb-4 scroll-area bg-gray-50 p-3 rounded-lg border border-gray-200">
                                    {room.notes.length > 0 ? (
                                        room.notes.map((note, index) => (
                                            <div key={index} className="flex justify-between items-start text-sm p-2 bg-white rounded-md shadow-sm border border-teal-100">
                                                <p className="text-gray-700 break-words pr-2">{note}</p>
                                                <button
                                                    onClick={() => handleNoteDelete(index)}
                                                    className="flex-shrink-0 text-red-500 hover:text-red-700 transition no-print"
                                                    aria-label="Delete Note"
                                                    title="Delete Note"
                                                >
                                                    <Plus className="w-4 h-4 transform rotate-45" />
                                                </button>
                                            </div>
                                        ))
                                    ) : (
                                        <p className="text-sm text-gray-500 text-center">No detailed notes yet.</p>
                                    )}
                                </div>
                                <div className="flex space-x-2 input-group no-print">
                                    <input
                                        type="text"
                                        value={newNote}
                                        onChange={(e) => setNewNote(e.target.value)}
                                        onKeyDown={(e) => e.key === 'Enter' && handleNoteAdd()}
                                        placeholder="Add a new observation..."
                                        className="flex-grow p-2 border border-gray-300 rounded-l-lg focus:ring-teal-500 focus:border-teal-500"
                                    />
                                    <button
                                        onClick={handleNoteAdd}
                                        className="bg-teal-500 text-white p-2 rounded-r-lg hover:bg-teal-600 transition"
                                    >
                                        Add
                                    </button>
                                </div>
                            </div>
                            
                            {/* Photos Section */}
                            <div>
                                <h4 className="flex items-center text-lg font-semibold text-indigo-600 mb-2">
                                    <Image className="w-5 h-5 mr-2"/> Photos
                                </h4>
                                <div className="photo-grid grid grid-cols-2 sm:grid-cols-3 gap-3 mb-4">
                                    {room.photos.map((photo, index) => (
                                        <div key={index} className="relative aspect-square overflow-hidden rounded-lg shadow-md border-2 border-indigo-100 group">
                                            <img
                                                src={photo.dataUrl}
                                                alt={`Room Photo ${index + 1}`}
                                                className="w-full h-full object-cover"
                                            />
                                            {/* Web display of timestamp on hover */}
                                            <div className="photo-meta absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-[10px] p-1 opacity-0 group-hover:opacity-100 transition duration-150 no-print">
                                                <div className="truncate">Captured: {photo.timestamp}</div>
                                            </div>

                                            {/* Print-only metadata display */}
                                            <div className="photo-meta hidden print:block text-xs mt-1">
                                                <p>Time: {photo.timestamp}</p>
                                            </div>

                                            <button
                                                onClick={() => handlePhotoDelete(index)}
                                                className="absolute top-1 right-1 p-1 bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition duration-150 hover:bg-red-700 no-print"
                                                aria-label="Delete Photo"
                                                title="Delete Photo"
                                            >
                                                <Plus className="w-4 h-4 transform rotate-45" />
                                            </button>
                                        </div>
                                    ))}
                                </div>
                                <div className="file-input-wrapper input-group no-print">
                                    <button 
                                        className="w-full bg-indigo-500 text-white p-3 rounded-lg shadow-md hover:bg-indigo-600 transition flex items-center justify-center space-x-2"
                                        disabled={isCapturing}
                                    >
                                        {isCapturing ? (
                                            <div className="flex items-center">
                                                <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle><path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                                                <span>Processing Photo...</span>
                                            </div>
                                        ) : (
                                            <>
                                                <Plus className="w-5 h-5" />
                                                <span>Capture Photo / Upload Image</span>
                                            </>
                                        )}
                                    </button>
                                    {/* 'capture="camera"' is key for mobile devices to open the camera directly */}
                                    <input type="file" id={`photo-input-${room.id}`} accept="image/*" capture="camera" onChange={handlePhotoChange} disabled={isCapturing} />
                                </div>
                            </div>

                        </div>
                    )}
                </div>
            );
        };

        // --- Main App Component ---
        const App = () => {
            const [ledger, setLedger] = useState(loadData);
            const [selectedPropertyId, setSelectedPropertyId] = useState(null);
            // State for the custom confirmation modal
            const [confirmState, setConfirmState] = useState(null);

            // Custom confirm function replacement for window.confirm
            const customConfirm = (message) => new Promise(resolve => {
                setConfirmState({
                    message,
                    onConfirm: () => { setConfirmState(null); resolve(true); },
                    onCancel: () => { setConfirmState(null); resolve(false); }
                });
            });

            // Load initial data and set initial selected property
            useEffect(() => {
                const data = loadData();
                setLedger(data);
                if (data.properties.length > 0 && !selectedPropertyId) {
                    setSelectedPropertyId(data.properties[0].id);
                }
            }, []);

            // Save data whenever the ledger state changes
            useEffect(() => {
                saveData(ledger);
            }, [ledger]);

            const selectedProperty = useMemo(() => {
                return ledger.properties.find(p => p.id === selectedPropertyId);
            }, [ledger.properties, selectedPropertyId]);

            // --- Property Management ---
            
            const addProperty = useCallback(() => {
                // Using window.prompt since it's informational/non-blocking
                const name = window.prompt("Enter the name/address of the new property:");
                if (name && name.trim()) {
                    const newProperty = {
                        id: Date.now().toString(),
                        name: name.trim(),
                        rooms: []
                    };
                    setLedger(prev => ({ 
                        ...prev, 
                        properties: [...prev.properties, newProperty] 
                    }));
                    setSelectedPropertyId(newProperty.id); 
                }
            }, []);

            const deleteProperty = useCallback(async (id) => {
                if (ledger.properties.length === 0) return;

                const confirmed = await customConfirm("Are you sure you want to delete this property and ALL its data (rooms, notes, photos)? This cannot be undone.");

                if (confirmed) {
                    const newProperties = ledger.properties.filter(p => p.id !== id);
                    
                    setLedger(prev => ({ 
                        ...prev, 
                        properties: newProperties 
                    }));

                    // Select the next available property, or null
                    if (selectedPropertyId === id) {
                        setSelectedPropertyId(newProperties.length > 0 ? newProperties[0].id : null);
                    }
                }
            }, [ledger.properties, selectedPropertyId]);

            const updatePropertyName = useCallback((id, newName) => {
                 setLedger(prev => ({
                    ...prev,
                    properties: prev.properties.map(p => 
                        p.id === id ? { ...p, name: newName } : p
                    )
                }));
            }, []);

            // --- Room Management ---
            
            const addRoom = useCallback(() => {
                if (!selectedPropertyId) return;

                const roomName = window.prompt("Enter the name of the new room (e.g., Kitchen, Hallway):");
                if (roomName && roomName.trim()) {
                    // Using a timestamp + random suffix for robust, unique ID generation
                    const newRoom = {
                        id: Date.now().toString() + '-' + Math.random().toString(36).substring(2, 9), 
                        name: roomName.trim(),
                        notes: [],
                        photos: [] 
                    };
                    
                    setLedger(prev => ({
                        ...prev,
                        properties: prev.properties.map(p => 
                            p.id === selectedPropertyId 
                                ? { ...p, rooms: [...p.rooms, newRoom] } 
                                : p
                        )
                    }));
                }
            }, [selectedPropertyId]);

            const updateRoom = useCallback((propId, roomId, updates) => {
                setLedger(prev => ({
                    ...prev,
                    properties: prev.properties.map(p => {
                        if (p.id !== propId) return p;
                        return {
                            ...p,
                            rooms: p.rooms.map(r => 
                                r.id === roomId ? { ...r, ...updates } : r
                            )
                        };
                    })
                }));
            }, []);

            const deleteRoom = useCallback((propId, roomId) => {
                setLedger(prev => ({
                    ...prev,
                    properties: prev.properties.map(p => {
                        if (p.id !== propId) return p;
                        return {
                            ...p,
                            rooms: p.rooms.filter(r => r.id !== roomId)
                        };
                    })
                }));
            }, []);
            
            // --- Export Function ---
            const handlePrintExport = () => {
                if (selectedProperty) {
                    window.print();
                } else {
                    window.alert("Please select a property to export.");
                }
            };


            // --- Render ---

            return (
                <div className="w-full max-w-4xl">
                    {/* Confirmation Modal Render */}
                    {confirmState && <CustomConfirm {...confirmState} />}
                    
                    <header id="app-header" className="p-4 sm:p-6 bg-white rounded-xl shadow-xl mb-8 no-print">
                        <h1 className="text-3xl font-extrabold text-blue-700 mb-2">
                            Property Walkthrough Ledger
                        </h1>
                        <p className="text-gray-600 mb-4 text-sm">
                            Your data is saved locally on this device.
                        </p>

                        <div className="flex flex-col sm:flex-row sm:items-center space-y-3 sm:space-y-0 sm:space-x-4 pt-4 border-t border-gray-100">
                            {/* Property Selector */}
                            <label htmlFor="property-select" className="text-sm font-medium text-gray-700 flex-shrink-0">
                                Current Property:
                            </label>
                            
                            <select
                                id="property-select"
                                value={selectedPropertyId || ''}
                                onChange={(e) => setSelectedPropertyId(e.target.value)}
                                className="flex-grow bg-gray-50 border border-gray-300 rounded-lg p-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 shadow-sm sm:max-w-xs"
                            >
                                {ledger.properties.length === 0 ? (
                                    <option value="">No Properties Added</option>
                                ) : (
                                    ledger.properties.map(p => (
                                        <option key={p.id} value={p.id}>{p.name}</option>
                                    ))
                                )}
                            </select>

                            <button
                                onClick={addProperty}
                                className="flex items-center bg-green-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-green-600 transition duration-150 shadow-lg active:scale-[0.98] text-sm"
                            >
                                <Plus className="w-4 h-4 mr-2" />
                                Add Property
                            </button>
                            
                            {selectedPropertyId && (
                                <button
                                    onClick={() => deleteProperty(selectedPropertyId)}
                                    className="flex items-center bg-red-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-red-600 transition duration-150 shadow-lg active:scale-[0.98] text-sm"
                                >
                                    <Trash2 className="w-4 h-4 mr-2" />
                                    Delete Property
                                </button>
                            )}
                        </div>
                    </header>
                    
                    <main id="property-view">
                        {!selectedPropertyId || ledger.properties.length === 0 ? (
                            <div className="text-center p-10 border-2 border-dashed border-gray-300 rounded-xl bg-white shadow-inner">
                                <p className="text-xl text-gray-500 mb-4">
                                    Start by adding your first property.
                                </p>
                                <button
                                    onClick={addProperty}
                                    className="flex items-center mx-auto bg-blue-500 text-white font-medium py-3 px-6 rounded-lg hover:bg-blue-600 transition duration-150 shadow-xl active:scale-[0.98] text-base"
                                >
                                    <Plus className="w-5 h-5 mr-2" />
                                    Add New Property
                                </button>
                            </div>
                        ) : (
                            <>
                                <div className="property-summary flex justify-between items-center mb-6 p-4 bg-white rounded-xl shadow-md">
                                    <div className="w-full">
                                        <label className="no-print block text-sm font-medium text-gray-700 mb-1">Property Name</label>
                                        <input
                                            type="text"
                                            value={selectedProperty.name}
                                            onChange={(e) => updatePropertyName(selectedPropertyId, e.target.value)}
                                            placeholder="Enter property address or name"
                                            className="w-full bg-gray-50 border border-gray-300 rounded-lg p-3 text-lg font-semibold focus:ring-blue-500 focus:border-blue-500 transition duration-150"
                                        />
                                    </div>
                                    <button
                                        onClick={handlePrintExport}
                                        className="no-print flex items-center bg-purple-600 text-white font-medium py-3 px-4 rounded-xl hover:bg-purple-700 transition duration-150 shadow-lg active:scale-[0.98] ml-4 flex-shrink-0"
                                        title="Export as Print-Ready PDF"
                                    >
                                        <Printer className="w-5 h-5 mr-2" />
                                        Export PDF
                                    </button>
                                </div>
                                
                                <div className="space-y-6">
                                    {selectedProperty.rooms.map(room => (
                                        <RoomCard
                                            key={room.id}
                                            room={room}
                                            updateRoom={updateRoom}
                                            deleteRoom={deleteRoom}
                                            propertyId={selectedPropertyId}
                                            confirm={customConfirm}
                                        />
                                    ))}
                                </div>
                                
                                <button
                                    onClick={addRoom}
                                    className="add-room-btn fixed bottom-6 right-6 bg-blue-600 text-white p-4 rounded-full shadow-2xl transition transform hover:scale-105 z-20 no-print"
                                    aria-label="Add New Room"
                                    title="Add New Room"
                                >
                                    <Plus className="w-6 h-6" />
                                </button>
                                
                                {selectedProperty.rooms.length === 0 && (
                                    <div className="text-center p-10 border-2 border-dashed border-indigo-200 rounded-xl bg-white shadow-inner mt-6">
                                        <p className="text-xl text-gray-500">
                                            Click the blue **(+)** button to add your first room to this property.
                                        </p>
                                    </div>
                                )}
                            </>
                        )}
                    </main>
                </div>
            );
        };

        // Render the App
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);

    </script>
</body>
</html>
